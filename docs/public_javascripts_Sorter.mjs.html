<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/javascripts/Sorter.mjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/javascripts/Sorter.mjs</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * @file sortingAlgorithm - sort technologies following a set of criteria
 * @author dhmmasson &lt;@dhmmasson>
 */
import * as Models from "./Models/index.mjs" ;
import { EventFirer } from "./EventFirer.mjs" ;
import { definePrivateProperties } from "./utils.mjs" ;

/**
  * Sorter - the sortingAlgorithm wrapper class
  *
  * @class
  * @extends EventFirer
  */
class Sorter extends EventFirer {

  /**
   * constructor - initialize everything
   *
   * @param  {module:Models.Technology[]} [technologies] description
   * @param  {module:Models.Criterion[]} [criteria]   description
   */
  constructor( technologies, criteria ) {
    super() ;

    /** @property {Object} technologies - all the technologies
     * @property {module:Models.Technology[]} technologies.all Array of all the technologies
     * @property {Object} technologies.sorted Array of all the technologies sorted by latest computed score
     * @property {Object} technologies.map ap of all the technologies to be sorted, call the setter
     * */
    this.technologies = technologies ;

    /** @property {Object} criteria - all the criteria
     * @property {module:Models.Criterion[]} criteria.all Array of all the criteria
     * @property {module:Models.Criterion[]} criteria.updated Array of all the criteria that have been recently updated
     * @property {Object.&lt;string, module:Models.Criterion[]>} criteria.map Array of all the criteria that have been recently updated
     */
    this.criteria = criteria ;

    definePrivateProperties( this, "_technologies", "_criteria" ) ;
  }


  /**
   * set technologies - initialize the technology map, reset the sorted arrays
   *
   * @param  {module:Models.Technology[]} technologies json serialized technology array
   */
  set technologies ( technologies ) {
    this._technologies =
    { all    : []
    , sorted : []
    , map    : {}
    } ;
    // Recreate object from the json serialization
    for( const serialization of technologies ) {

      /** @type module:Models.Technology */
      const technology = new Models.Technology( serialization ) ;
      this._technologies.all.push( technology ) ;
      this._technologies.map[ technology.name ] = technology ;
    }
  }


  /**
   * get technologies - return the object _technologies
   *
   * @return {type}  description
   */
  get technologies( ) {
    return this._technologies ;
  }

  /**
   * set criteria - initialize the criteria map, reset the values
   *
   * @param  {module:Models.Criterion[]} Criterion description
   */
  set criteria ( criteria ) {
    this._criteria =
    { all     : []
    , map     : {}
    , updated : []
    } ;
    // Recreate object from the json serialization
    for( const _criterion of criteria ) {
      const criterion = new Models.Criterion( _criterion ) ;
      this._criteria.map[ criterion.name ] = criterion ;
      this._criteria.all.push( criterion ) ;
      // watch for update
      criterion.on( Models.Criterion.eventType.updated
        , ( eventName, criterion ) => {
          this._criteria.updated.push( criterion ) ;
          this.sort() ;
        }, this ) ;
    }
    // Clone the criteria as all should be updated
    this._criteria.updated = this._criteria.all.slice() ;
  }


  /**
   * get criteria - description
   *
   * @return {type}  description
   */
  get criteria( ) {
    return this._criteria ;
  }


  /**
   * sort - sort all technologies. UpdateBounds > UpdateDominance > UpdateScore then sort.
   * Clear updatedCriteria.
   * fire event:Sorter.eventType.sorted
   *
   * @return {Sorter}  this
   */
  sort( ) {
    this.updateBounds().updateDominance().updateScore() ;
    // Clone technologies array and sort through score
    this.technologies.sorted = this.technologies.all.slice().sort( ( a, b ) => b.score - a.score ) ;
    this.criteria.updated = [] ;
    this.fire( Sorter.eventType.sorted ) ;
    return this ;
  }


  /**
   * updateDominance - refresh all dominance
   *
   * @return {Sorter}  this
   */
  updateDominance( ) {
    this.technologies.all.forEach( e => e.updateDominance( this.criteria.updated, this.technologies.all ) ) ;
    return this ;
  }


  /**
   * updateBounds - refresh technology bounds for the updated criteria
   *
   * @return {Sorter}  this sorter
   */
  updateBounds( ) {
    this.technologies.all.forEach( e => e.updateBounds( this.criteria.updated ) ) ;
    return this ;
  }


  /**
   * updateScore - refresh the score of all technologies
   *
   * @return {Sorter}  this
   */
  updateScore( ) {
    this.technologies.all.forEach( e => e.updateScore( this.criteria.all ) ) ;
    return this ;
  }


}

/**
 * Sorter.eventType
 * @enum {string}
 * @readonly
 */
Sorter.eventType =
{ "sorted": "sorted" } ;

export { Sorter } ;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ExpressUtils.html">ExpressUtils</a></li><li><a href="module-HttpUtils.html">HttpUtils</a></li><li><a href="module-Models.html">Models</a></li></ul><h3>Classes</h3><ul><li><a href="EventFirer.html">EventFirer</a></li><li><a href="module-ExpressUtils.Connector.html">Connector</a></li><li><a href="module-Models.Criterion.html">Criterion</a></li><li><a href="module-Models.Evaluation.html">Evaluation</a></li><li><a href="module-Models.Technology.html">Technology</a></li><li><a href="Sorter.html">Sorter</a></li></ul><h3>Global</h3><ul><li><a href="global.html#definePrivateProperties">definePrivateProperties</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Feb 18 2020 23:51:07 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
